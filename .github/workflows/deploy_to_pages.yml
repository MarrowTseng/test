# 1. å·¥ä½œæµç¨‹åç¨±
name: Deploy Static Website to Pages

# 2. æ¬Šé™è¨­å®š (å¿…è¦ï¼ç¢ºä¿ Actions æœ‰æ¬Šé™å¯«å…¥ Pages)
permissions:
  contents: read
  pages: write
  id-token: write

# 3. è§¸ç™¼æ¢ä»¶ï¼šç•¶æ¨é€åˆ° main åˆ†æ”¯æ™‚åŸ·è¡Œ
on:
  push:
    branches: ["main"]

# ç¢ºä¿åŒæ™‚åªæœ‰ä¸€å€‹éƒ¨ç½²åœ¨é€²è¡Œ
concurrency:
  group: "pages"
  cancel-in-progress: true

# 4. ä»»å‹™ (Jobs) å®šç¾©
jobs:
  # ä»»å‹™ 1ï¼šå»ºæ§‹ (Build) ç¶²ç«™
  build:
    runs-on: ubuntu-latest  # ä½¿ç”¨æœ€æ–°çš„ Ubuntu è™›æ“¬æ©Ÿ
    steps:
      - name: Checkout Code # æ­¥é©Ÿ 1: ä¸‹è¼‰ç¨‹å¼ç¢¼
        uses: actions/checkout@v4

      # -- ğŸš€ é€™è£¡æ‚¨å¯ä»¥æ›¿æ›æˆæ‚¨çš„å°ˆæ¡ˆå»ºæ§‹æ­¥é©Ÿ --
      
      # [ç¯„ä¾‹ï¼šéœæ…‹ç¶²ç«™] 
      # å¦‚æœæ‚¨çš„å°ˆæ¡ˆåªéœ€è¦éœæ…‹ HTML/CSSï¼Œä¸éœ€è¦å»ºæ§‹æ­¥é©Ÿï¼Œå¯ä»¥åªæ”¾ä¸€å€‹ç°¡å–®çš„æŒ‡ä»¤
      - name: Setup Build Output
        run: |
          cd
          mkdir build_output  # å»ºç«‹ä¸€å€‹è³‡æ–™å¤¾ä¾†å­˜æ”¾æˆå“
          cp index.html build_output/ # å°‡æ‚¨çš„ç¶²ç«™é¦–é æª”æ¡ˆè¤‡è£½é€²å»
          # å‡è¨­æ‚¨çš„ç¶²ç«™æª”æ¡ˆéƒ½åœ¨æ ¹ç›®éŒ„ï¼Œä¸¦å°‡å®ƒå€‘ç§»å‹•æˆ–è¤‡è£½åˆ° 'build_output' è³‡æ–™å¤¾

      # [ç¯„ä¾‹ï¼šNode.js/Vite/React å°ˆæ¡ˆ] 
      # å¦‚æœæ‚¨æ˜¯å‰ç«¯å°ˆæ¡ˆï¼Œè«‹æ›¿æ›æˆä»¥ä¸‹æ­¥é©Ÿï¼š
      # - name: Set up Node.js
      #   uses: actions/setup-node@v4
      #   with:
      #     node-version: 20
      # - name: Install Dependencies
      #   run: npm install
      # - name: Build Website (å‡è¨­è¼¸å‡ºåˆ° 'dist' è³‡æ–™å¤¾)
      #   run: npm run build 
      # ---------------------------------------------

      # æ­¥é©Ÿ 2: é…ç½® GitHub Pages
      # é€™æ˜¯å›ºå®šçš„é…ç½®ï¼Œç”¨æ–¼å‘Šè¨´éƒ¨ç½² Action éƒ¨ç½²çš„æˆå“åœ¨å“ª
      - name: Setup Pages
        uses: actions/configure-pages@v5

      # æ­¥é©Ÿ 3: ä¸Šå‚³å»ºæ§‹æˆå“ (Artifact)
      # with.path å¿…é ˆæŒ‡å‘æ‚¨çš„ç¶²ç«™å»ºæ§‹è¼¸å‡ºçš„è³‡æ–™å¤¾ï¼
      # æ‰¿æ¥ä¸Šé¢çš„ç¯„ä¾‹ï¼Œæˆ‘å€‘ä½¿ç”¨ 'build_output' ä½œç‚ºå»ºæ§‹æˆå“è³‡æ–™å¤¾ã€‚
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: 'build_output' # <--- é€™è£¡éå¸¸é‡è¦ï¼è«‹æ”¹æˆæ‚¨çš„ç¶²ç«™å»ºæ§‹è¼¸å‡ºç›®éŒ„

  # ä»»å‹™ 2ï¼šéƒ¨ç½² (Deployment) ç¶²ç«™
  deploy:
    environment:
      name: github-pages  # ç¶å®šåˆ° Pages ç’°å¢ƒ (æä¾›ä»‹é¢é¡¯ç¤º)
      url: ${{ steps.deployment.outputs.page_url }} # é¡¯ç¤ºéƒ¨ç½²å¾Œçš„ç¶²å€
    runs-on: ubuntu-latest
    needs: build  # <--- ç¢ºä¿é€™å€‹ Job æœƒåœ¨ 'build' Job å®Œæˆå¾Œæ‰é–‹å§‹åŸ·è¡Œ
    steps:
      # æ­¥é©Ÿ 4: åŸ·è¡Œéƒ¨ç½²
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4 # å®˜æ–¹éƒ¨ç½² Actionsï¼Œæœƒä½¿ç”¨ä¸Šå€‹ Job ä¸Šå‚³çš„æˆå“
